<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª²ç¨‹è³‡æ–™ç®¡ç†å¾Œå°</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; background: #f0f2f5; }
        h2 { color: #333; }
        
        .controls { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; gap: 10px; align-items: center; }
        
        table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 14px; }
        th { background-color: #2c3e50; color: white; position: sticky; top: 0; }
        
        input, select { width: 100%; padding: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        
        .btn { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; color: white; font-weight: bold; }
        .btn-add { background-color: #28a745; }
        .btn-save { background-color: #007bff; }
        .btn-del { background-color: #dc3545; padding: 5px 10px; font-size: 12px; }
        .btn:hover { opacity: 0.9; }

        .json-preview { margin-top: 20px; }
        textarea { width: 100%; height: 150px; font-family: monospace; }
    </style>
</head>
<body>

    <h2>ğŸ› ï¸ è³‡å‚³ç³»èª²ç¨‹è¡¨ - è³‡æ–™ç”¢ç”Ÿå™¨</h2>

    <div class="controls">
        <button class="btn btn-add" onclick="addNewRow()">+ æ–°å¢èª²ç¨‹</button>
        <button class="btn btn-save" onclick="downloadJSON()">â¬‡ï¸ ä¸‹è¼‰ data.json</button>
        <span style="color: #666; font-size: 0.9em; margin-left: auto;">ä¿®æ”¹å®Œè«‹ä¸‹è¼‰æª”æ¡ˆï¼Œä¸¦è¦†è“‹å°ˆæ¡ˆä¸­çš„ data.json</span>
    </div>

    <table id="editTable">
        <thead>
            <tr>
                <th width="8%">ä»£ç¢¼</th>
                <th width="15%">èª²ç¨‹åç¨±</th>
                <th width="12%">æ•™å¸«</th>
                <th width="5%">é€±</th>
                <th width="8%">ç¯€æ¬¡(ç”¨é€—è™Ÿåˆ†é–‹)</th>
                <th width="8%">æ•™å®¤</th>
                <th width="5%">å¹´ç´š</th>
                <th width="5%">ç­ç´šé¡åˆ¥</th>
                <th width="5%">å¿…ä¿®</th>
                <th width="8%">é¡¯ç¤ºç­ç´š</th>
                <th width="5%">æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="tbody">
            </tbody>
    </table>

    <div class="json-preview">
        <h3>JSON é è¦½ (é™¤éŒ¯ç”¨)</h3>
        <textarea id="jsonOutput" readonly></textarea>
    </div>

    <script>
        // 1. é è¨­è³‡æ–™ (æˆ–æ˜¯å¾ fetch è®€å–)
        // é€™è£¡æ”¾æ‚¨æœ€æ–°çš„ data.json å…§å®¹ä½œç‚ºåˆå§‹å€¼
        let currentData = {
            "metadata": { "semester": "113-1", "department": "è³‡å‚³ç³»" },
            "timeSlots": [ /* çœç•¥ timeSlotsï¼Œå‡è¨­ä¸å¸¸æ”¹ï¼Œç·¨è¼¯å™¨åªå°ˆæ³¨æ”¹ courses */ ], 
            "courses": [
                { "code": "C201", "name": "è³‡è¨Šå‚³æ’­å°ˆé¡Œ(ä¸€)", "teacher": "ç‹å¤§æ˜", "day": 1, "periods": ["3", "4"], "room": "CB205", "year": "2", "classType": "a", "required": true, "className": "äºŒç”²" },
                { "code": "C301", "name": "æ•¸æ“šè³‡æ–™åˆ†æ", "teacher": "æå°è¯", "day": 1, "periods": ["3", "4"], "room": "W401", "year": "3", "classType": "b", "required": true, "className": "ä¸‰ä¹™" }
                // ... æ›´å¤šè³‡æ–™
            ]
        };

        // å¦‚æœæ‚¨æœ‰çœŸå¯¦çš„ timeSlots çµæ§‹ï¼Œè«‹ç¢ºä¿è¼¸å‡ºçš„ JSON åŒ…å«å®ƒï¼Œé€™è£¡ç‚ºäº†ç¤ºç¯„å…ˆè£œä¸Šé è¨­çµæ§‹
        const defaultTimeSlots = [
            { "period": "1", "time": "08:10<br>~<br>09:00" },
            { "period": "2", "time": "09:10<br>~<br>10:00" },
            // ... (è«‹å°‡æ‚¨å®Œæ•´çš„ timeSlots è²¼å›é€™è£¡ä»¥å…è³‡æ–™éºå¤±)
            { "period": "12-14", "time": "19:10<br>~<br>22:00" }
        ];

        // åˆå§‹åŒ–
        function init() {
            renderTable();
            updatePreview();
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';

            currentData.courses.forEach((course, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input type="text" value="${course.code}" onchange="updateData(${index}, 'code', this.value)"></td>
                    <td><input type="text" value="${course.name}" onchange="updateData(${index}, 'name', this.value)"></td>
                    <td><input type="text" value="${course.teacher}" onchange="updateData(${index}, 'teacher', this.value)"></td>
                    <td><input type="number" min="1" max="5" value="${course.day}" onchange="updateData(${index}, 'day', parseInt(this.value))"></td>
                    <td><input type="text" value="${course.periods.join(',')}" onchange="updatePeriods(${index}, this.value)"></td>
                    <td><input type="text" value="${course.room}" onchange="updateData(${index}, 'room', this.value)"></td>
                    <td><input type="text" value="${course.year}" onchange="updateData(${index}, 'year', this.value)"></td>
                    <td>
                        <select onchange="updateData(${index}, 'classType', this.value)">
                            <option value="a" ${course.classType === 'a' ? 'selected' : ''}>ç”² (a)</option>
                            <option value="b" ${course.classType === 'b' ? 'selected' : ''}>ä¹™ (b)</option>
                            <option value="common" ${course.classType === 'common' ? 'selected' : ''}>å…± (common)</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="updateData(${index}, 'required', this.value === 'true')">
                            <option value="true" ${course.required ? 'selected' : ''}>æ˜¯</option>
                            <option value="false" ${!course.required ? 'selected' : ''}>å¦</option>
                        </select>
                    </td>
                    <td><input type="text" value="${course.className}" onchange="updateData(${index}, 'className', this.value)"></td>
                    <td style="text-align:center;"><button class="btn btn-del" onclick="deleteRow(${index})">åˆªé™¤</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // æ›´æ–°è³‡æ–™
        window.updateData = function(index, field, value) {
            currentData.courses[index][field] = value;
            updatePreview();
        };

        // ç‰¹åˆ¥è™•ç†ç¯€æ¬¡ (å­—ä¸²è½‰é™£åˆ—)
        window.updatePeriods = function(index, value) {
            // "3,4" -> ["3", "4"]
            const arr = value.split(',').map(s => s.trim());
            currentData.courses[index].periods = arr;
            updatePreview();
        };

        // æ–°å¢ä¸€è¡Œ
        window.addNewRow = function() {
            currentData.courses.unshift({
                code: "NEW001", name: "æ–°èª²ç¨‹", teacher: "è€å¸«", day: 1, periods: ["1"], room: "", year: "1", classType: "common", required: false, className: "å¤§ä¸€"
            });
            renderTable();
            updatePreview();
        };

        // åˆªé™¤ä¸€è¡Œ
        window.deleteRow = function(index) {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™å ‚èª²å—ï¼Ÿ")) {
                currentData.courses.splice(index, 1);
                renderTable();
                updatePreview();
            }
        };

        // æ›´æ–° JSON é è¦½
        function updatePreview() {
            // çµ„åˆå®Œæ•´çš„çµæ§‹
            const fullData = {
                metadata: currentData.metadata,
                timeSlots: defaultTimeSlots, // ç¢ºä¿é€™éƒ¨åˆ†ä¸€ç›´å­˜åœ¨
                courses: currentData.courses
            };
            document.getElementById('jsonOutput').value = JSON.stringify(fullData, null, 2);
        }

        // ä¸‹è¼‰ JSON æª”æ¡ˆ
        window.downloadJSON = function() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(document.getElementById('jsonOutput').value);
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "data.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        };

        init();
    </script>
</body>
</html>
